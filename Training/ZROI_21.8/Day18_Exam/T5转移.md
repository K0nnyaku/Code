##### [类似的题目](https://www.luogu.com.cn/problem/P2051)

$dp[i][j][k][l]$表示考虑到第$i$行，有$j$列有正好一个棋子，有$k$列有正好两个棋子，有$l$列有正好三个棋子

令$tmp=M-j-k-l$（其实就是没放棋子的列数）

100表示将一个棋子放在一列导致其变成正好有一个棋子的列

010表示将一个棋子放在一列导致其变成正好有两个棋子的列

001表示将一个棋子放在一列导致其变成正好有三个棋子的列

200表示将两个棋子放在不同的两列导致这两列均变为正好有一个棋子的列

以此类推

### 不摆

$$
dp[i][j][k][l]+=dp[i-1][j][k][l]
$$

### 摆一个

##### 100

$$
dp[i][j][k][l]+=dp[i-1][j-1][k][l]*(tmp+1)
$$

##### 010

$$
dp[i][j][k][l]+=dp[i-1][j+1][k-1][l]*(j+1)
$$

##### 001

$$
dp[i][j][k][l]+=dp[i-1][j][k+1][l-1]*(k+1)
$$

### 摆两个

##### 200

$$
dp[i][j][k][l]+=dp[i-1][j-2][k][l]*(tmp+2)*(tmp+1)\div 2
$$

##### 110

$$
dp[i][j][k][l]+=dp[i-1][j][k-1][l]*(tmp+1)*j
$$

##### 101

$$
dp[i][j][k][l]+=dp[i-1][j-1][k+1][l-1]*(tmp+1)*(k+1)
$$

##### 020

$$
dp[i][j][k][l]+=dp[i-1][j+2][k-2][l]*(j+2)*(j+1)\div 2
$$

##### 011

$$
dp[i][j][k][l]+=dp[i-1][j+1][k][l-1]*(j+1)*k
$$

##### 002

$$
dp[i][j][k][l]+=dp[i-1][j][k+2][l-2]*(k+2)*(k+1)\div 2
$$

### 摆三个

##### 300

$$
dp[i][j][k][l]+=dp[i-1][j-3][k][l]*(tmp+3)*(tmp+2)*(tmp+1)\div 6
$$

##### 210

$$
dp[i][j][k][l]+=dp[i-1][j-1][k-1][l]*(tmp+2)*(tmp+1)*(j-1)\div 2
$$

##### 201

$$
dp[i][j][k][l]+=dp[i-1][j-2][k+1][l-1]*(tmp+2)*(tmp+1)*(k+1)\div 2
$$

##### 120

$$
dp[i][j][k][l]+=dp[i-1][j+1][k-2][l]*(tmp+1)*(j+1)*j\div 2
$$

##### 111

$$
dp[i][j][k][l]+=dp[i-1][j][k][l-1]*(tmp+1)*j*k
$$

##### 102

$$
dp[i][j][k][l]+=dp[i-1][j-1][k+2][l-2]*(tmp+1)*(k+2)*(k+1)\div 2
$$

##### 030

$$
dp[i][j][k][l]+=dp[i-1][j+3][k-3][l]*(j+3)*(j+2)*(j+1)\div 6
$$

##### 021

$$
dp[i][j][k][l]+=dp[i-1][j+2][k-1][l-1]*(j+2)*(j+1)*(k-1)\div 2
$$

##### 012

$$
dp[i][j][k][l]+=dp[i-1][j+1][k+1][l-2]*(j+1)*(k+1)*k\div 2
$$

##### 003

$$
dp[i][j][k][l]+=dp[i-1][j][k+3][l-3]*(k+3)*(k+2)*(k+1)\div 6
$$



